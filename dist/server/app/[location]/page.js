(()=>{var e={};e.id=635,e.ids=[635],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},96206:e=>{"use strict";e.exports=require("console")},6113:e=>{"use strict";e.exports=require("crypto")},67643:e=>{"use strict";e.exports=require("diagnostics_channel")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},15673:e=>{"use strict";e.exports=require("node:events")},84492:e=>{"use strict";e.exports=require("node:stream")},47261:e=>{"use strict";e.exports=require("node:util")},71017:e=>{"use strict";e.exports=require("path")},4074:e=>{"use strict";e.exports=require("perf_hooks")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},35356:e=>{"use strict";e.exports=require("stream/web")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},29830:e=>{"use strict";e.exports=require("util/types")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},63922:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>u,routeModule:()=>h,tree:()=>d});var r=s(73137),a=s(54647),o=s(4183),i=s.n(o),l=s(71775),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);s.d(t,n);let c=r.AppPageRouteModule,d=["",{children:["[location]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,32172)),"/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,54010)),"/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/page.tsx"],m="/[location]/page",p={require:s,loadChunk:()=>Promise.resolve()},h=new c({definition:{kind:a.x.APP_PAGE,page:"/[location]/page",pathname:"/[location]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7026:(e,t,s)=>{Promise.resolve().then(s.bind(s,33609)),Promise.resolve().then(s.bind(s,16333))},33609:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>PostBoard});var r=s(60080),a=s(52451),o=s.n(a),i=s(89817);let fetchPost=async(e,t,s)=>{let r=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:`${t}`}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),a=await r.json(),o=[];return a.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&o.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),console.log("rough data : ",a),o};var l=s(9885),n=s(95291),c=s(39093);function PostBoard(e){let[t,s]=(0,l.useState)(),a=(0,n.Zl)(c.curPostStore),[i,u]=(0,l.useState)(e.data),[m,p]=(0,l.useState)(40),[h,f]=(0,l.useState)(80),[x,g]=(0,l.useState)(!1),[v,j]=(0,l.useState)(!0),[y,w]=(0,n.FV)(c.isPostViewOpenStore),handleClickPost=e=>{a(e),w(!0)};return(0,l.useEffect)(()=>{if(v)j(!1);else{let t=fetchPost(m-40,e.location,h-40);t.then(e=>{let t=[];void 0!==i&&((t=[...i]).splice(m-40,40,...e),u(t),console.log("post updated",e))})}},[y]),(0,l.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(([t])=>{if(t.isIntersecting){console.log("진입",m,h);let t=fetchPost(m,e.location,h);t.then(e=>{void 0!==i&&(u([...i,...e]),p(e=>e+40),f(e=>e+40),g(!0),setTimeout(()=>{g(!1)},2e3))})}},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,h]),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"grid grid-cols-3 gap-1",children:void 0!==i&&i.map((e,t)=>(0,r.jsxs)(d,{className:"center",onClick:()=>handleClickPost(e),children:[r.jsx("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),r.jsx("div",{children:r.jsx(o(),{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t))}),r.jsx("div",{className:"flex flex-col",children:r.jsx("div",{className:"w-full h-[100vh]"})})]})}let d=i.ZP.div`
    transition: 0.2s ease;
    cursor: pointer;
    &:hover div{
        filter: brightness(.5);
    }
    &:hover p{
        opacity: 1;
    }
`},16333:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>PostView});var r=s(60080),a=s(52451),o=s.n(a),i=s(22723);function PostSlider(e){let t=e.post?.photo,s={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:r.jsx(function(e){let{className:t,style:s,onClick:a}=e;return r.jsx("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:a})},{})};return r.jsx("div",{className:"h-full w-full",children:void 0!==t&&1!==t.length?r.jsx(i.Z,{...s,children:t?.map((e,t)=>r.jsx("div",{className:"w-[40vw] h-[85vh]",children:r.jsx(o(),{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[85vh]"})},t))}):r.jsx("div",{className:"w-[40vw] h-[85vh] flex items-center",children:r.jsx(o(),{src:void 0!==t&&t[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[85vh]"})},0)})}s(25404),s(66332);var l=s(89817),n=s(9885);function PostContent(e){let{post:t,isModify:s,postId:a,idToken:o,setIsModify:i}=e,[l,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(""),m="text-black focus:outline-none rounded-md border-[1px] w-[12vw] p-2";return(0,n.useEffect)(()=>{t&&(c(t.title),u(t.content))},[t]),r.jsx("div",{children:s?(0,r.jsxs)("div",{children:[r.jsx("input",{value:l,onChange:e=>c(e.target.value),className:`${m} nnb`}),r.jsx("textarea",{value:d,onChange:e=>u(e.target.value),className:`${m} nnn text-[0.8rem]`}),r.jsx("button",{onClick:()=>{fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${a}?updateMask.fieldPaths=title`,{method:"PATCH",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({fields:{title:{stringValue:l}}})}).then(()=>{console.log("title 수정 완료")}).catch(e=>console.log(e)),fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${a}?updateMask.fieldPaths=content`,{method:"PATCH",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({fields:{content:{stringValue:d}}})}).then(()=>{console.log("content 수정 완료"),i(!1)}).catch(e=>console.log(e))},className:"w-[12vw] bg-[#003545] rounded-md text-sm py-1",children:"수정"})]}):(0,r.jsxs)("div",{children:[r.jsx("p",{className:"nnb",children:l}),r.jsx("pre",{className:"text-[0.8rem] nnn",children:d})]})})}var c=s(8886),d=s(37949),u=s(76580),m=s(95809),p=s(57734);async function deletePost(e){let t=await fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${e}`,{method:"DELETE"});t.json().then(()=>{console.log("게시물 삭제 완료")}).catch(e=>console.log("게시물 삭제 에러",e))}async function removeLike(e,t,s,r){let a;let o=[];0!==s.length&&(o=[...s]);let i=o.findIndex(e=>e.stringValue===a);o.splice(i,1);let l=fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=likes`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{likes:{arrayValue:{values:o}}}})});return r(o),(await l).json()}async function uploadLike(e,t,s,r){let a=localStorage.getItem("ddym-email"),o=[];0!==s.length&&(o=[...s]),o.push({stringValue:a});let i=fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=likes`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{likes:{arrayValue:{values:o}}}})});return r(o),(await i).json()}s(43562);var h=s(72856),f=s(88869);async function UploadComment(e,t,s,r){(0,h.ZF)(f.q);let a=localStorage.getItem("ddym-email"),o=[];0!==r.length&&(o=[...r]),o.push({mapValue:{fields:{comment:{stringValue:s},user:{stringValue:a}}}}),console.log(o),fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=comments`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{comments:{arrayValue:{values:o}}}})})}var x=s(95291),g=s(54392),v=s(39093),j=s(57114);function PostView(){let e=(0,j.useRouter)(),t=(0,x.sJ)(v.idTokenStore),s=(0,x.sJ)(v.userDataStore),[a,i]=(0,x.FV)(v.curPostStore),[l,h]=(0,n.useState)([0]),[f,w]=(0,n.useState)(""),[P,N]=(0,n.useState)([]),[b,k]=(0,n.useState)(!1),[V,S]=(0,n.useState)(""),[_,q]=(0,n.useState)("invisible"),[C,E]=(0,n.useState)(""),[A,T]=(0,x.FV)(v.isPostViewOpenStore),[$,U]=(0,n.useState)(!1),L={color:"black",width:20,cursor:"pointer"};(0,n.useEffect)(()=>{if(a){if(void 0!==a.likes?h([...a.likes]):h([]),void 0!==a.user&&(0,g.A)(a.user).then(e=>{void 0!==e&&""!==e.displayName?E(e.displayName):E(a.user)}),void 0!==a.name){let e=a.name.split("/");S(e[6])}a.comments.map(e=>{let t=e.mapValue.fields.user.stringValue;(0,g.A)(t).then(s=>{let r,a;void 0!==s&&(a=""!==s.photoURL?s.photoURL:p.Z,r={user:s.displayName,photoURL:a,email:t,comment:e.mapValue.fields.comment.stringValue}),N(e=>[...e,r])})})}},[a]),(0,n.useEffect)(()=>{let e=localStorage.getItem("ddym-email");void 0!==l.find(t=>t.stringValue===e)?k(!0):k(!1)},[l]),(0,n.useEffect)(()=>{A?q("flex"):q("invisible")},[A]);let handleClickProfile=t=>{e.push(`/profile/${t}`)};return r.jsx("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&($?window.confirm("게시물 수정을 취소하시겠습니까?")&&resetData():resetData());function resetData(){T(!1),N([]),h([0]),U(!1)}},className:`w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ${_}`,children:(0,r.jsxs)("div",{className:"flex w-[60vw] h-[85vh] bg-white shadow-2xl",children:[r.jsx("div",{className:"flex w-2/3 h-full ",children:r.jsx(PostSlider,{post:a})}),(0,r.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"p-6 flex-1",children:[(0,r.jsxs)("div",{className:"",children:[(0,r.jsxs)("div",{className:"flex nnn",children:[s?.photoURL===void 0?r.jsx(o(),{src:p.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):r.jsx(r.Fragment,{}),s?.displayName===void 0?r.jsx("p",{children:C}):r.jsx(r.Fragment,{children:s.displayName})]}),r.jsx("div",{className:"mt-1 ml-8",children:r.jsx(PostContent,{post:a,setIsModify:U,isModify:$,postId:V,idToken:t})})]}),r.jsx("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==P&&P.map((e,t)=>(0,r.jsxs)("div",{className:"mt-6 flex",children:[(0,r.jsxs)("div",{className:"flex cursor-pointer",onClick:()=>handleClickProfile(e.email),children:[r.jsx(o(),{src:e.photoURL,width:30,height:30,alt:"profile",className:"rounded-full object-cover aspect-square"}),r.jsx("p",{className:"nnb text-[0.8rem] ml-1",children:e.user})]}),r.jsx("p",{className:"nnn text-[0.7rem] ml-3",children:e.comment})]},t))})]}),(0,r.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,r.jsxs)("div",{className:"flex flex-1 mt-1",children:[b?r.jsx(y,{onClick:()=>{a&&removeLike(a,t,l,h)},children:r.jsx(c.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):r.jsx(y,{onClick:()=>{a&&""!==l?uploadLike(a,t,l,h):k(!0)},children:r.jsx(u.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,r.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[l.length," 명이 좋아합니다"]}),r.jsx("div",{className:"flex-1"}),(0,r.jsxs)("div",{className:"mt-[-2px]",children:[r.jsx(m.Z,{sx:L,onClick:()=>{window.confirm("게시물을 삭제하시겠습니까?")&&(deletePost(V),T(!1),i(null))}}),r.jsx(d.Z,{sx:L,onClick:()=>{U(!0)}})]})]}),(0,r.jsxs)("div",{className:"flex flex-row",children:[r.jsx("input",{value:f,onChange:e=>w(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),r.jsx("button",{onClick:()=>{let e=localStorage.getItem("ddym-email");a&&""!==f&&(UploadComment(a,t,f,a.comments),e&&(0,g.A)(e).then(t=>{if(void 0!==t){let s={email:e,photoURL:t?.photoURL,comment:f,user:t?.displayName};N(e=>[...e,s])}}),w(""))},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let y=l.ZP.div`
    transition: 0.15s ease;
    height: 2vh;
    transform-origin: center;
    &:active {
        scale:1.3
    }
`},54392:(e,t,s)=>{"use strict";s.d(t,{A:()=>getProfile});let getProfile=async e=>{let t;console.log("looking for",e,"'s data");let s=await fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/${e}`,{method:"GET"}),r=await s.json();return void 0!==r.fields&&(t={displayName:r.fields.displayName.stringValue,photoURL:r.fields.photoURL.stringValue,follower:r.fields.follewer.arrayValue.values,follow:r.fields.follow.arrayValue.values}),t}},32172:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Board});var r=s(48144),a=s(17536);let o=(0,a.createProxy)(String.raw`/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/postBoard.tsx`),{__esModule:i,$$typeof:l}=o,n=o.default,c=(0,a.createProxy)(String.raw`/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/postView/postView.tsx`),{__esModule:d,$$typeof:u}=c,m=c.default,fetchPost=async(e,t,s)=>{let r=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:`${t}`}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),a=await r.json(),o=[];return a.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&o.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),console.log("rough data : ",a),o},swtichName=e=>{switch(e){case"gyeonggi":return"경기";case"incheon":return"인천";case"seoul":return"서울";case"kyungnam":return"경상남도";case"kyungbuk":return"경상북도";case"jeonnam":return"전라남도";case"jeonbuk":return"전라북도";case"busan":return"부산";case"ulsan":return"울산";case"daegu":return"대구";case"chungbuk":return"충청북도";case"chungnam":return"충청남도";case"gangwon":return"강원";case"gwangju":return"광주";case"daejeon":return"대전";case"jeju":return"제주"}};async function Board(e){let t=e.params.location,s=swtichName(t),a=await fetchPost(0,t);return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("title",{children:`대동, 너의 지도 | ${t}`}),r.jsx("p",{className:"text-white text-[2rem] mb-6 nnb",children:s}),r.jsx(n,{data:a,data2:a,location:t}),r.jsx(m,{})]})}},57481:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var r=s(96885);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,r.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[311,885,817,466,666],()=>__webpack_exec__(63922));module.exports=s})();