(()=>{var e={};e.id=635,e.ids=[635],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},50852:e=>{"use strict";e.exports=require("async_hooks")},14300:e=>{"use strict";e.exports=require("buffer")},96206:e=>{"use strict";e.exports=require("console")},6113:e=>{"use strict";e.exports=require("crypto")},67643:e=>{"use strict";e.exports=require("diagnostics_channel")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},15673:e=>{"use strict";e.exports=require("node:events")},84492:e=>{"use strict";e.exports=require("node:stream")},47261:e=>{"use strict";e.exports=require("node:util")},71017:e=>{"use strict";e.exports=require("path")},4074:e=>{"use strict";e.exports=require("perf_hooks")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},35356:e=>{"use strict";e.exports=require("stream/web")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},29830:e=>{"use strict";e.exports=require("util/types")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},63922:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>p,pages:()=>u,routeModule:()=>h,tree:()=>d});var r=s(73137),a=s(54647),o=s(4183),i=s.n(o),l=s(71775),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);s.d(t,n);let c=r.AppPageRouteModule,d=["",{children:["[location]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,32172)),"/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,54010)),"/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,57481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/page.tsx"],p="/[location]/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new c({definition:{kind:a.x.APP_PAGE,page:"/[location]/page",pathname:"/[location]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7026:(e,t,s)=>{Promise.resolve().then(s.bind(s,33609)),Promise.resolve().then(s.bind(s,16333))},33609:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>PostBoard});var r=s(60080),a=s(52451),o=s.n(a),i=s(89817);let fetchPost=async(e,t,s)=>{let r=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:`${t}`}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),a=await r.json(),o=[];return a.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&o.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),o};var l=s(9885),n=s(95291),c=s(39093);function PostBoard(e){let[t,s]=(0,l.useState)(),a=(0,n.Zl)(c.curPostStore),[i,u]=(0,l.useState)(e.data),[p,m]=(0,l.useState)(40),[h,f]=(0,l.useState)(80),[x,g]=(0,l.useState)(!1),[v,j]=(0,l.useState)(!0),[y,w]=(0,n.FV)(c.isPostViewOpenStore),handleClickPost=e=>{a(e),w(!0)};return(0,l.useEffect)(()=>{if(v)j(!1);else{let t=fetchPost(p-40,e.location,h-40);t.then(e=>{let t=[];void 0!==i&&((t=[...i]).splice(p-40,40,...e),u(t),console.log("post updated",e))})}},[y]),(0,l.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(([t])=>{if(t.isIntersecting){console.log("진입",p,h);let t=fetchPost(p,e.location,h);t.then(e=>{void 0!==i&&(u([...i,...e]),m(e=>e+40),f(e=>e+40),g(!0),setTimeout(()=>{g(!1)},2e3))})}},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,h]),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"grid grid-cols-3 gap-1",children:void 0!==i&&i.map((e,t)=>(0,r.jsxs)(d,{className:"center",onClick:()=>handleClickPost(e),children:[r.jsx("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),r.jsx("div",{children:r.jsx(o(),{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t))}),r.jsx("div",{className:"flex flex-col",children:r.jsx("div",{className:"w-full h-[100vh]"})})]})}let d=i.ZP.div`
    transition: 0.2s ease;
    cursor: pointer;
    &:hover div{
        filter: brightness(.5);
    }
    &:hover p{
        opacity: 1;
    }
`},16333:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>PostView});var r=s(60080),a=s(52451),o=s.n(a),i=s(22723);function PostSlider(e){let t=e.post?.photo,s={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:r.jsx(function(e){let{className:t,style:s,onClick:a}=e;return r.jsx("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:a})},{})};return r.jsx("div",{className:"h-full w-full",children:void 0!==t&&1!==t.length?r.jsx(i.Z,{...s,children:t?.map((e,t)=>r.jsx("div",{className:"w-[40vw] h-[85vh]",children:r.jsx(o(),{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[85vh]"})},t))}):r.jsx("div",{className:"w-[40vw] h-[85vh] flex items-center",children:r.jsx(o(),{src:void 0!==t&&t[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[85vh]"})},0)})}s(25404),s(66332);var l=s(89817),n=s(9885);function PostContent(e){let{post:t,isModify:s,postId:a,idToken:o,setIsModify:i}=e,[l,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(""),p="text-black focus:outline-none rounded-md border-[1px] w-[12vw] p-2";return(0,n.useEffect)(()=>{t&&(c(t.title),u(t.content))},[t]),r.jsx("div",{children:s?(0,r.jsxs)("div",{children:[r.jsx("input",{value:l,onChange:e=>c(e.target.value),className:`${p} nnb`}),r.jsx("textarea",{value:d,onChange:e=>u(e.target.value),className:`${p} nnn text-[0.8rem]`}),r.jsx("button",{onClick:()=>{fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${a}?updateMask.fieldPaths=title`,{method:"PATCH",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({fields:{title:{stringValue:l}}})}).then(()=>{console.log("title 수정 완료")}).catch(e=>console.log(e)),fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${a}?updateMask.fieldPaths=content`,{method:"PATCH",headers:{Authorization:`Bearer ${o}`},body:JSON.stringify({fields:{content:{stringValue:d}}})}).then(()=>{console.log("content 수정 완료"),i(!1)}).catch(e=>console.log(e))},className:"w-[12vw] bg-[#003545] rounded-md text-sm py-1",children:"수정"})]}):(0,r.jsxs)("div",{children:[r.jsx("p",{className:"nnb",children:l}),r.jsx("pre",{className:"text-[0.8rem] nnn",children:d})]})})}var c=s(8886),d=s(37949),u=s(76580),p=s(95809),m=s(57734),h=s(43562);async function deletePost(e){let t=await fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/${e}`,{method:"DELETE"});t.json().then(()=>{console.log("게시물 삭제 완료")}).catch(e=>console.log("게시물 삭제 에러",e))}async function removeLike(e,t,s,r){let a;let o=[];0!==s.length&&(o=[...s]);let i=o.findIndex(e=>e.stringValue===a);o.splice(i,1);let l=fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=likes`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{likes:{arrayValue:{values:o}}}})});return r(o),(await l).json()}async function uploadLike(e,t,s,r){let a=localStorage.getItem("ddym-email"),o=[];0!==s.length&&(o=[...s]),o.push({stringValue:a});let i=fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=likes`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{likes:{arrayValue:{values:o}}}})});return r(o),(await i).json()}var f=s(88869),x=s(72856);async function UploadComment(e,t,s,r,a){(0,x.ZF)(f.q);let o=(0,h.v0)(),i=[];0!==r.length&&(i=[...r]),i.push({mapValue:{fields:{user:{stringValue:o.currentUser&&o.currentUser.email},comment:{stringValue:s}}}});let l=fetch(`https://firestore.googleapis.com/v1/${e.name}?updateMask.fieldPaths=comments`,{method:"PATCH",headers:{Authorization:`Bearer ${t}`},body:JSON.stringify({fields:{comments:{arrayValue:{values:i}}}})});return a(i),(await l).json()}var g=s(95291),v=s(54392),j=s(39093);function PostView(){let e=(0,g.sJ)(j.idTokenStore),t=(0,g.sJ)(j.userDataStore),[s,a]=(0,g.FV)(j.curPostStore),[i,l]=(0,n.useState)([0]),[h,f]=(0,n.useState)([]),[x,w]=(0,n.useState)(""),[P,N]=(0,n.useState)(!1),[b,k]=(0,n.useState)(""),[V,_]=(0,n.useState)("invisible"),[S,q]=(0,n.useState)(""),[C,E]=(0,g.FV)(j.isPostViewOpenStore),[T,A]=(0,n.useState)(!1),$={color:"black",width:20,cursor:"pointer"};return(0,n.useEffect)(()=>{if(s){if(void 0!==s.likes?l([...s.likes]):l([]),void 0!==s.user){(0,v.A)(s.user).then(e=>{void 0!==e&&""!==e.displayName?q(e.displayName):q(s.user)});let e=[...h];s.comments.map((t,s)=>{""!==t.mapValue.fields.user.stringValue&&(0,v.A)(t.mapValue.fields.user.stringValue).then(r=>{console.log("test : ",t.mapValue.fields.user.stringValue,r),void 0!==r&&(e[s].user=r.displayName)})}),f(e)}if(void 0!==s.name){let e=s.name.split("/");k(e[6])}}},[s]),(0,n.useEffect)(()=>{let e=localStorage.getItem("ddym-email");void 0!==i.find(t=>t.stringValue===e)?N(!0):N(!1)},[i]),(0,n.useEffect)(()=>{C?_("flex"):_("invisible")},[C]),r.jsx("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&(T?window.confirm("게시물 수정을 취소하시겠습니까?")&&resetData():resetData());function resetData(){E(!1),f([0]),l([0]),A(!1)}},className:`w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ${V}`,children:(0,r.jsxs)("div",{className:"flex w-[60vw] h-[85vh] bg-white shadow-2xl",children:[r.jsx("div",{className:"flex w-2/3 h-full ",children:r.jsx(PostSlider,{post:s})}),(0,r.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"p-6 flex-1",children:[(0,r.jsxs)("div",{className:"",children:[(0,r.jsxs)("div",{className:"flex nnn",children:[t?.photoURL===void 0?r.jsx(o(),{src:m.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):r.jsx(r.Fragment,{}),t?.displayName===void 0?r.jsx("p",{children:S}):r.jsx(r.Fragment,{children:t.displayName})]}),r.jsx("div",{className:"mt-1 ml-8",children:r.jsx(PostContent,{post:s,setIsModify:A,isModify:T,postId:b,idToken:e})})]}),r.jsx("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==h&&h.map((e,t)=>(0,r.jsxs)("div",{children:[r.jsx("p",{className:"nnn text-[0.8rem] mt-6",children:void 0!==e.mapValue&&e.mapValue.fields.user.stringValue}),r.jsx("p",{className:"nnn text-[0.7rem]",children:void 0!==e.mapValue&&e.mapValue.fields.comment.stringValue})]},t))})]}),(0,r.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,r.jsxs)("div",{className:"flex flex-1 mt-1",children:[P?r.jsx(y,{onClick:()=>{s&&removeLike(s,e,i,l)},children:r.jsx(c.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):r.jsx(y,{onClick:()=>{s&&""!==i?uploadLike(s,e,i,l):N(!0)},children:r.jsx(u.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,r.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[i.length," 명이 좋아합니다"]}),r.jsx("div",{className:"flex-1"}),(0,r.jsxs)("div",{className:"mt-[-2px]",children:[r.jsx(p.Z,{sx:$,onClick:()=>{window.confirm("게시물을 삭제하시겠습니까?")&&(deletePost(b),E(!1),a(null))}}),r.jsx(d.Z,{sx:$,onClick:()=>{A(!0)}})]})]}),(0,r.jsxs)("div",{className:"flex flex-row",children:[r.jsx("input",{value:x,onChange:e=>w(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),r.jsx("button",{onClick:()=>{s&&""!==x&&UploadComment(s,e,x,h,f).then(e=>{console.log("댓글 추가 성공",e),w("")}).catch(e=>{console.log("댓글 추가 실패",e)})},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let y=l.ZP.div`
    transition: 0.15s ease;
    height: 2vh;
    transform-origin: center;
    &:active {
        scale:1.3
    }
`},54392:(e,t,s)=>{"use strict";s.d(t,{A:()=>getProfile});let getProfile=async e=>{let t;console.log("looking for",e,"...");let s=await fetch(`https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/${e}`,{method:"GET"}),r=await s.json();return void 0!==r.field&&(t={displayName:r.fields.displayName.stringValue,photoURL:r.fields.photoURL.stringValue,follower:r.fields.follewer.arrayValue.values,follow:r.fields.follow.arrayValue.values}),t}},32172:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Board});var r=s(48144),a=s(17536);let o=(0,a.createProxy)(String.raw`/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/postBoard.tsx`),{__esModule:i,$$typeof:l}=o,n=o.default,c=(0,a.createProxy)(String.raw`/Users/hongseungjae/Desktop/learning.js/daedongyourmap/app/[location]/postView/postView.tsx`),{__esModule:d,$$typeof:u}=c,p=c.default,fetchPost=async(e,t,s)=>{let r=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:`${t}`}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),a=await r.json(),o=[];return a.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&o.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),o},swtichName=e=>{switch(e){case"gyeonggi":return"경기";case"incheon":return"인천";case"seoul":return"서울";case"kyungnam":return"경상남도";case"kyungbuk":return"경상북도";case"jeonnam":return"전라남도";case"jeonbuk":return"전라북도";case"busan":return"부산";case"ulsan":return"울산";case"daegu":return"대구";case"chungbuk":return"충청북도";case"chungnam":return"충청남도";case"gangwon":return"강원";case"gwangju":return"광주";case"daejeon":return"대전";case"jeju":return"제주"}};async function Board(e){let t=e.params.location,s=swtichName(t),a=await fetchPost(0,t);return(0,r.jsxs)("div",{className:"flex flex-col items-center",children:[r.jsx("p",{className:"text-white text-[2rem] mb-6 nnb",children:s}),r.jsx(n,{data:a,data2:a,location:t}),r.jsx(p,{})]})}},57481:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var r=s(96885);let __WEBPACK_DEFAULT_EXPORT__=e=>{let t=(0,r.fillMetadataSegment)(".",e.params,"favicon.ico");return[{type:"image/x-icon",sizes:"16x16",url:t+""}]}}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[311,885,817,466,666],()=>__webpack_exec__(63922));module.exports=s})();