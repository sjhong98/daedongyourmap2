(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{4370:function(e,t,s){Promise.resolve().then(s.bind(s,7378)),Promise.resolve().then(s.bind(s,8186))},7378:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var o=s(6093),a=s(3827),n=s(703),l=s(9712);let i=async(e,t,s)=>{let o=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:"".concat(t)}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),a=await o.json(),n=[];return a.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&n.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),console.log("rough data : ",a),n};var r=s(4090),c=s(2153),d=s(9700);function A(){let e=(0,o._)(["\n    transition: 0.2s ease;\n    cursor: pointer;\n    &:hover div{\n        filter: brightness(.5);\n    }\n    &:hover p{\n        opacity: 1;\n    }\n"]);return A=function(){return e},e}function u(e){let[t,s]=(0,r.useState)(),o=(0,c.Zl)(d.curPostStore),[l,A]=(0,r.useState)(e.data),[u,m]=(0,r.useState)(40),[f,p]=(0,r.useState)(80),[v,g]=(0,r.useState)(!1),[x,j]=(0,r.useState)(!0),[w,y]=(0,c.FV)(d.postCreatedStore),[N,S]=(0,c.FV)(d.isPostViewOpenStore),k=e=>{o(e),S(!0)};return(0,r.useEffect)(()=>{!x||w?i(u-40,e.location,f-40).then(e=>{let t=[];void 0!==l&&((t=[...l]).splice(u-40,40,...e),A(t),y(!1),console.log("post updated",e))}):j(!1)},[N]),(0,r.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(t=>{let[s]=t;s.isIntersecting&&(console.log("진입",u,f),i(u,e.location,f).then(e=>{void 0!==l&&(A([...l,...e]),m(e=>e+40),p(e=>e+40),g(!0),setTimeout(()=>{g(!1)},2e3))}))},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,f]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"grid grid-cols-3 gap-1",children:void 0!==l&&l.map((e,t)=>(0,a.jsxs)(h,{className:"center",onClick:()=>k(e),children:[(0,a.jsx)("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),(0,a.jsx)("div",{children:(0,a.jsx)(n.default,{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t))}),(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)("div",{className:"w-full h-[100vh]"})})]})}let h=l.ZP.div(A())},8186:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return E}});var o=s(6093),a=s(3827),n=s(703),l=s(9359);function i(e){var t;let s=null===(t=e.post)||void 0===t?void 0:t.photo,o={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:(0,a.jsx)(function(e){let{className:t,style:s,onClick:o}=e;return(0,a.jsx)("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:o})},{})};return(0,a.jsx)("div",{className:"h-full w-full",children:void 0!==s&&1!==s.length?(0,a.jsx)(l.Z,{...o,children:null==s?void 0:s.map((e,t)=>(0,a.jsx)("div",{className:"w-[40vw] h-[80vh]",children:(0,a.jsx)(n.default,{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[80vh]"})},t))}):(0,a.jsx)("div",{className:"w-[40vw] h-[80vh] flex items-center",children:(0,a.jsx)(n.default,{src:void 0!==s&&s[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[80vh]"})},0)})}s(5768),s(8694);var r=s(9712),c=s(4090);function d(e){let{post:t,isModify:s,postId:o,idToken:n,setIsModify:l}=e,[i,r]=(0,c.useState)(""),[d,A]=(0,c.useState)(""),u="text-black focus:outline-none rounded-md border-[1px] w-[12vw] p-2";return(0,c.useEffect)(()=>{t&&(r(t.title),A(t.content))},[t]),(0,a.jsx)("div",{children:s?(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{value:i,onChange:e=>r(e.target.value),className:"".concat(u," nnb")}),(0,a.jsx)("textarea",{value:d,onChange:e=>A(e.target.value),className:"".concat(u," nnn text-[0.8rem]")}),(0,a.jsx)("button",{onClick:()=>{fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(o,"?updateMask.fieldPaths=title"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(n)},body:JSON.stringify({fields:{title:{stringValue:i}}})}).then(()=>{console.log("title 수정 완료")}).catch(e=>console.log(e)),fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(o,"?updateMask.fieldPaths=content"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(n)},body:JSON.stringify({fields:{content:{stringValue:d}}})}).then(()=>{console.log("content 수정 완료"),l(!1)}).catch(e=>console.log(e))},className:"w-[12vw] bg-[#003545] rounded-md text-sm py-1",children:"수정"})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"nnb",children:i}),(0,a.jsx)("pre",{className:"text-[0.8rem] nnn",children:d})]})})}var A=s(2486),u=s(4383),h=s(1897),m=s(7e3),f=s(9214),p=s(7907),v=s(4905);async function g(e,t,s){return new Promise(o=>{fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(e),{method:"DELETE"}).then(()=>{let e=(0,v.cF)();for(let a=0;a<s;a++)(0,v.oq)((0,v.iH)(e,"".concat(t,"-").concat(a))).then(e=>o(e)).catch(e=>console.log(e,"게시물 삭제 실패"))}).catch(e=>console.log("게시물 삭제 에러",e))})}async function x(e,t,s,o){let a;null!==localStorage&&localStorage.getItem("ddym-email");let n=[];0!==s.length&&(n=[...s]);let l=n.findIndex(e=>e.stringValue===a);n.splice(l,1);let i=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:n}}}})});return o(n),(await i).json()}async function j(e,t,s,o){let a=localStorage.getItem("ddym-email"),n=[];0!==s.length&&(n=[...s]),n.push({stringValue:a});let l=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:n}}}})});return o(n),(await l).json()}var w=s(2153),y=s(9487),N=s(6142),S=s(8800);async function k(e,t,s,o){(0,N.ZF)(S.q);let a=localStorage.getItem("ddym-email"),n=[];0!==o.length&&(n=[...o]),n.push({mapValue:{fields:{comment:{stringValue:s},user:{stringValue:a}}}}),console.log(n),fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=comments"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{comments:{arrayValue:{values:n}}}})})}var b=s(9700);function B(){let e=(0,o._)(["\n    transition: 0.15s ease;\n    height: 2vh;\n    transform-origin: center;\n    &:active {\n        scale:1.3\n    }\n"]);return B=function(){return e},e}function E(){let e=(0,p.useRouter)(),t=(0,w.sJ)(b.idTokenStore),s=(0,w.sJ)(b.userDataStore),[o,l]=(0,w.FV)(b.curPostStore),[r,v]=(0,c.useState)([0]),[N,S]=(0,c.useState)(""),[B,E]=(0,c.useState)([]),[P,C]=(0,c.useState)(!1),[I,Q]=(0,c.useState)(""),[O,z]=(0,c.useState)("invisible"),[D,T]=(0,c.useState)(""),[L,R]=(0,w.FV)(b.isPostViewOpenStore),[F,U]=(0,c.useState)(!1),Z={color:"black",width:20,cursor:"pointer"};(0,c.useEffect)(()=>{o&&(void 0!==o.likes?v([...o.likes]):v([]),void 0!==o.user&&(0,y.A)(o.user).then(e=>{void 0!==e&&""!==e.displayName?T(e.displayName):T(o.user)}),void 0!==o.name&&Q(o.name.split("/")[6]),o.comments.map(e=>{let t=e.mapValue.fields.user.stringValue;(0,y.A)(t).then(s=>{let o,a;void 0!==s&&(a=""!==s.photoURL?s.photoURL:f.Z,o={user:s.displayName,photoURL:a,email:t,comment:e.mapValue.fields.comment.stringValue}),E(e=>[...e,o])})}))},[o]),(0,c.useEffect)(()=>{let e=localStorage.getItem("ddym-email");void 0!==r.find(t=>t.stringValue===e)?C(!0):C(!1)},[r]),(0,c.useEffect)(()=>{L?z("flex"):z("invisible")},[L]);let M=t=>{e.push("/profile/".concat(t))};return(0,a.jsx)("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&(F?window.confirm("게시물 수정을 취소하시겠습니까?")&&t():t());function t(){R(!1),E([]),v([0]),U(!1)}},className:"w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ".concat(O),children:(0,a.jsxs)("div",{className:"flex w-[60vw] h-[80vh] bg-white shadow-2xl overflow-hidden",children:[(0,a.jsx)("div",{className:"flex w-2/3 h-full",children:(0,a.jsx)(i,{post:o})}),(0,a.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-6 flex-1",children:[(0,a.jsxs)("div",{className:"",children:[(0,a.jsxs)("div",{className:"flex nnn",children:[(null==s?void 0:s.photoURL)===void 0?(0,a.jsx)(n.default,{src:f.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):(0,a.jsx)(a.Fragment,{}),(null==s?void 0:s.displayName)===void 0?(0,a.jsx)("p",{children:D}):(0,a.jsx)(a.Fragment,{children:s.displayName})]}),(0,a.jsx)("div",{className:"mt-1 ml-8",children:(0,a.jsx)(d,{post:o,setIsModify:U,isModify:F,postId:I,idToken:t})})]}),(0,a.jsx)("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==B&&B.map((e,t)=>(0,a.jsxs)("div",{className:"mt-6 flex",children:[(0,a.jsxs)("div",{className:"flex cursor-pointer",onClick:()=>M(e.email),children:[(0,a.jsx)(n.default,{src:e.photoURL,width:30,height:30,alt:"profile",className:"rounded-full object-cover aspect-square"}),(0,a.jsx)("p",{className:"nnb text-[0.8rem] ml-1",children:e.user})]}),(0,a.jsx)("p",{className:"nnn text-[0.7rem] ml-3",children:e.comment})]},t))})]}),(0,a.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,a.jsxs)("div",{className:"flex flex-1 mt-1",children:[P?(0,a.jsx)(V,{onClick:()=>{o&&x(o,t,r,v)},children:(0,a.jsx)(A.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):(0,a.jsx)(V,{onClick:()=>{o&&""!==r?j(o,t,r,v):C(!0)},children:(0,a.jsx)(h.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,a.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[r.length," 명이 좋아합니다"]}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsxs)("div",{className:"mt-[-2px]",children:[(0,a.jsx)(m.Z,{sx:Z,onClick:()=>{window.confirm("게시물을 삭제하시겠습니까?")&&(null==o?void 0:o.name)!==void 0&&g(I,null==o?void 0:o.name,null==o?void 0:o.photo.length).then(()=>{R(!1),l(null)})}}),(0,a.jsx)(u.Z,{sx:Z,onClick:()=>{U(!0)}})]})]}),(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)("input",{value:N,onChange:e=>S(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),(0,a.jsx)("button",{onClick:()=>{let e=localStorage.getItem("ddym-email");o&&""!==N&&(k(o,t,N,o.comments),e&&(0,y.A)(e).then(t=>{if(void 0!==t){let s={email:e,photoURL:null==t?void 0:t.photoURL,comment:N,user:null==t?void 0:t.displayName};E(e=>[...e,s])}}),S(""))},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let V=r.ZP.div(B())},9487:function(e,t,s){"use strict";s.d(t,{A:function(){return o}});let o=async e=>{let t;console.log("looking for",e,"'s data");let s=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/".concat(e),{method:"GET"}),o=await s.json();return void 0!==o.fields&&(t={displayName:o.fields.displayName.stringValue,photoURL:o.fields.photoURL.stringValue,follower:o.fields.follewer.arrayValue.values,follow:o.fields.follow.arrayValue.values}),t}},9700:function(e,t,s){"use strict";s.r(t),s.d(t,{curComments:function(){return r},curPostStore:function(){return u},default:function(){return m},idTokenStore:function(){return c},isLoginStore:function(){return i},isPostViewOpenStore:function(){return h},postCreatedStore:function(){return n},profileStore:function(){return l},selectedPointStore:function(){return A},userDataStore:function(){return d}});var o=s(3827);s(4090);var a=s(2153);let n=(0,a.cn)({key:"postCreated",default:!1}),l=(0,a.cn)({key:"profile",default:{}}),i=(0,a.cn)({key:"isLogin",default:!1}),r=(0,a.cn)({key:"curComments",default:""}),c=(0,a.cn)({key:"idTokenStore",default:""}),d=(0,a.cn)({key:"userDataStore",default:null}),A=(0,a.cn)({key:"selectedPointStore",default:""}),u=(0,a.cn)({key:"curPostStore",default:null}),h=(0,a.cn)({key:"isPostViewOpen",default:!1});function m(e){let{children:t}=e;return(0,o.jsx)(a.Wh,{children:t})}},8800:function(e,t,s){"use strict";s.d(t,{q:function(){return o}});let o={apiKey:"AIzaSyCA6Q_TA6dyl7wf2BtR_V_oEVIW2_Q94y0",authDomain:"daedongyourmap-ad63d.firebaseapp.com",projectId:"daedongyourmap-ad63d",storageBucket:"daedongyourmap-ad63d.appspot.com",messagingSenderId:"68098855208",appId:"1:68098855208:web:aa0e9a5602074a3b6c401d",measurementId:"G-7X00QEEQ08"}},9214:function(e,t){"use strict";t.Z={src:"/_next/static/media/defaultProfilePic.513224af.jpeg",height:360,width:360,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGmB//EABUQAQEAAAAAAAAAAAAAAAAAABMj/9oACAEBAAEFAkv/AP/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABgQAAIDAAAAAAAAAAAAAAAAAAARARIx/9oACAEBAAY/AlaViP/EABcQAQADAAAAAAAAAAAAAAAAABEAIZH/2gAIAQEAAT8hGQKZ/9oADAMBAAIAAwAAABAD/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAwEBPxB//8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAgEBPxB//8QAFxAAAwEAAAAAAAAAAAAAAAAAAEHB8P/aAAgBAQABPxDVAVn/2Q==",blurWidth:8,blurHeight:8}}},function(e){e.O(0,[691,749,723,869,75,486,4,920,971,69,744],function(){return e(e.s=4370)}),_N_E=e.O()}]);