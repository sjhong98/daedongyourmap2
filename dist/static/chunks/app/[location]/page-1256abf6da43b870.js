(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{7559:function(e,t,s){Promise.resolve().then(s.bind(s,2587)),Promise.resolve().then(s.bind(s,8843))},4023:function(e,t,s){"use strict";s.d(t,{S:function(){return fetchPost}});let fetchPost=async(e,t,s)=>{let l=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:"".concat(t)}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),n=await l.json(),a=[];return n.map(e=>{let t=e.document;void 0!==t&&a.push({createTime:t.createTime,title:t.fields.title.stringValue,content:t.fields.content.stringValue,point:t.fields.point.stringValue,photo:t.fields.photo.arrayValue.values,user:t.fields.user.stringValue,comments:t.fields.comments.arrayValue.values,name:t.name,likes:t.fields.likes.arrayValue.values})}),a}},2587:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostBoard}});var l=s(230),n=s(7437),a=s(6691),i=s.n(a),o=s(1806),r=s(4023),c=s(2265),d=s(5883),u=s(62);function _templateObject(){let e=(0,l._)(["\n    transition: 0.2s ease;\n    cursor: pointer;\n    &:hover div{\n        filter: brightness(.5);\n    }\n    &:hover p{\n        opacity: 1;\n    }\n"]);return _templateObject=function(){return e},e}function PostBoard(e){let[t,s]=(0,c.useState)(),l=(0,d.Zl)(u.curPostStore),[a,o]=(0,c.useState)(e.data),[m,h]=(0,c.useState)(40),[A,v]=(0,c.useState)(80),[p,g]=(0,c.useState)(!1),[x,j]=(0,d.FV)(u.isPostViewOpenStore),handleClickPost=e=>{l(e),j(!0)};return(0,c.useEffect)(()=>{let t=(0,r.S)(m-40,e.location,A-40);t.then(e=>{void 0!==a&&(o([...a,...e]),console.log("post updated",e))})},[x]),(0,c.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(t=>{let[s]=t;if(s.isIntersecting){console.log("진입",m,A);let t=(0,r.S)(m,e.location,A);t.then(e=>{void 0!==a&&(o([...a,...e]),h(e=>e+40),v(e=>e+40),g(!0),setTimeout(()=>{g(!1)},2e3))})}},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,A]),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-1 min-h-[150vh]",children:[void 0!==a&&a.map((e,t)=>(0,n.jsxs)(f,{className:"center",onClick:()=>handleClickPost(e),children:[(0,n.jsx)("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),(0,n.jsx)("div",{children:(0,n.jsx)(i(),{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t)),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"w-screen min-h-[120vh] flex-1"}),p?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)("div",{ref:s,className:"w-screen h-[10vh] bg-red-500"})]})]})}let f=o.ZP.div(_templateObject())},8843:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostView}});var l=s(230),n=s(7437),a=s(6691),i=s.n(a),o=s(4741);function PostSlider(e){var t;let s=null===(t=e.post)||void 0===t?void 0:t.photo,l={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:(0,n.jsx)(function(e){let{className:t,style:s,onClick:l}=e;return(0,n.jsx)("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:l})},{})};return(0,n.jsx)("div",{className:"h-full w-full",children:void 0!==s&&1!==s.length?(0,n.jsx)(o.Z,{...l,children:null==s?void 0:s.map((e,t)=>(0,n.jsx)("div",{className:"w-[40vw] h-[85vh]",children:(0,n.jsx)(i(),{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[85vh]"})},t))}):(0,n.jsx)("div",{className:"w-[40vw] h-[85vh] flex items-center",children:(0,n.jsx)(i(),{src:void 0!==s&&s[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[85vh]"})},0)})}s(9051),s(5291);var r=s(1806),c=s(7216),d=s(6986),u=s(9903),f=s(3085),m=s(4023);async function removeLike(e,t,s,l){let n;null!==localStorage&&localStorage.getItem("ddym-email");let a=[];0!==s.length&&(a=[...s]);let i=a.findIndex(e=>e.stringValue===n);a.splice(i,1);let o=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:a}}}})});return l(a),(await o).json()}async function uploadLike(e,t,s,l){let n=localStorage.getItem("ddym-email"),a=[];0!==s.length&&(a=[...s]),a.push({stringValue:n});let i=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:a}}}})});return l(a),(await i).json()}var h=s(2265),A=s(5075),v=s(994);async function UploadComment(e,t,s,l,n){(0,v.ZF)(A.q);let a=(0,f.v0)(),i=[];0!==l.length&&(i=[...l]),i.push({mapValue:{fields:{user:{stringValue:a.currentUser&&a.currentUser.email},comment:{stringValue:s}}}});let o=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=comments"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{comments:{arrayValue:{values:i}}}})});return n(i),(await o).json()}var p=s(5883),g=s(9783),x=s(62);function _templateObject(){let e=(0,l._)(["\n    transition: 0.15s ease;\n    height: 2vh;\n    transform-origin: center;\n    &:active {\n        scale:1.3\n    }\n"]);return _templateObject=function(){return e},e}function PostView(){let e=(0,p.sJ)(x.curPostStore),t=(0,p.sJ)(x.idTokenStore),[s,l]=(0,h.useState)([0]),a=(0,p.sJ)(x.userDataStore),[o,r]=(0,h.useState)([]),[f,A]=(0,h.useState)(""),[v,w]=(0,h.useState)(!1),[N,y]=(0,h.useState)("invisible"),[S,V]=(0,h.useState)(""),[k,b]=(0,p.FV)(x.isPostViewOpenStore);return(0,h.useEffect)(()=>{if(e&&void 0!==e.likes?l([...e.likes]):l([]),e&&void 0!==e.user){(0,g.A)(e.user).then(t=>{void 0!==t&&""!==t.displayName?V(t.displayName):V(e.user)});let t=[...o];e.comments.map((e,s)=>{""!==e.mapValue.fields.user.stringValue&&(0,g.A)(e.mapValue.fields.user.stringValue).then(l=>{console.log("test : ",e.mapValue.fields.user.stringValue,l),void 0!==l&&(t[s].user=l.displayName)})}),r(t)}},[e]),(0,h.useEffect)(()=>{let e;void 0!==localStorage&&localStorage.getItem("ddym-email"),void 0!==s.find(t=>t.stringValue===e)?w(!0):w(!1)},[s]),(0,h.useEffect)(()=>{k?y("flex"):y("invisible")},[k]),(0,n.jsx)("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&(b(!1),r([0]),l([0]),m.S)},className:"w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ".concat(N),children:(0,n.jsxs)("div",{className:"flex w-[60vw] h-[85vh] bg-white shadow-2xl",children:[(0,n.jsx)("div",{className:"flex w-2/3 h-full ",children:(0,n.jsx)(PostSlider,{post:e})}),(0,n.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,n.jsxs)("div",{className:"p-6 flex-1",children:[(0,n.jsxs)("div",{className:"",children:[(0,n.jsxs)("div",{className:"flex nnn",children:[(null==a?void 0:a.photoURL)===void 0?(0,n.jsx)(i(),{src:u.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):(0,n.jsx)(n.Fragment,{}),(null==a?void 0:a.displayName)===void 0?(0,n.jsx)("p",{children:S}):(0,n.jsx)(n.Fragment,{children:a.displayName})]}),(0,n.jsxs)("div",{className:"mt-1 ml-8",children:[(0,n.jsx)("p",{className:"nnb",children:null==e?void 0:e.title}),(0,n.jsx)("p",{className:"text-[0.8rem] nnn",children:null==e?void 0:e.content})]})]}),(0,n.jsx)("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==o&&o.map((e,t)=>(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"nnn text-[0.8rem] mt-6",children:void 0!==e.mapValue&&e.mapValue.fields.user.stringValue}),(0,n.jsx)("p",{className:"nnn text-[0.7rem]",children:void 0!==e.mapValue&&e.mapValue.fields.comment.stringValue})]},t))})]}),(0,n.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,n.jsxs)("div",{className:"flex flex flex-1 mt-1",children:[v?(0,n.jsx)(j,{onClick:()=>{e&&removeLike(e,t,s,l)},children:(0,n.jsx)(c.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):(0,n.jsx)(j,{onClick:()=>{e&&""!==s?uploadLike(e,t,s,l):w(!0)},children:(0,n.jsx)(d.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,n.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[s.length," 명이 좋아합니다"]})]}),(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsx)("input",{value:f,onChange:e=>A(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),(0,n.jsx)("button",{onClick:()=>{e&&""!==f&&UploadComment(e,t,f,o,r).then(e=>{console.log("댓글 추가 성공",e),A("")}).catch(e=>{console.log("댓글 추가 실패",e)})},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let j=r.ZP.div(_templateObject())},9783:function(e,t,s){"use strict";s.d(t,{A:function(){return getProfile}});let getProfile=async e=>{let t;console.log("looking for",e,"...");let s=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/".concat(e),{method:"GET"}),l=await s.json();return void 0!==l.field&&(t={displayName:l.fields.displayName.stringValue,photoURL:l.fields.photoURL.stringValue,follower:l.fields.follewer.arrayValue.values,follow:l.fields.follow.arrayValue.values}),t}},62:function(e,t,s){"use strict";s.r(t),s.d(t,{curComments:function(){return o},curPostStore:function(){return u},default:function(){return RecoilContextProvider},idTokenStore:function(){return r},isLoginStore:function(){return i},isPostViewOpenStore:function(){return f},profileStore:function(){return a},selectedPointStore:function(){return d},userDataStore:function(){return c}});var l=s(7437);s(2265);var n=s(5883);let a=(0,n.cn)({key:"profile",default:{}}),i=(0,n.cn)({key:"isLogin",default:!1}),o=(0,n.cn)({key:"curComments",default:""}),r=(0,n.cn)({key:"idTokenStore",default:""}),c=(0,n.cn)({key:"userDataStore",default:null}),d=(0,n.cn)({key:"selectedPointStore",default:""}),u=(0,n.cn)({key:"curPostStore",default:null}),f=(0,n.cn)({key:"isPostViewOpen",default:!1});function RecoilContextProvider(e){let{children:t}=e;return(0,l.jsx)(n.Wh,{children:t})}},5075:function(e,t,s){"use strict";s.d(t,{q:function(){return l}});let l={apiKey:"AIzaSyCA6Q_TA6dyl7wf2BtR_V_oEVIW2_Q94y0",authDomain:"daedongyourmap-ad63d.firebaseapp.com",projectId:"daedongyourmap-ad63d",storageBucket:"daedongyourmap-ad63d.appspot.com",messagingSenderId:"68098855208",appId:"1:68098855208:web:aa0e9a5602074a3b6c401d",measurementId:"G-7X00QEEQ08"}},9903:function(e,t){"use strict";t.Z={src:"/_next/static/media/defaultProfilePic.513224af.jpeg",height:360,width:360,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAeEAABAwQDAAAAAAAAAAAAAAAAEhMVAgMUIjNB8f/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCmSNM+3k3G+NtOqvewAB//2Q==",blurWidth:8,blurHeight:8}}},function(e){e.O(0,[691,380,964,928,13,161,472,732,898,971,864,744],function(){return e(e.s=7559)}),_N_E=e.O()}]);