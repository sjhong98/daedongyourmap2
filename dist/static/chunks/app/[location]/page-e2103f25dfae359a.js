(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{7559:function(e,t,s){Promise.resolve().then(s.bind(s,3230)),Promise.resolve().then(s.bind(s,2974))},3230:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostBoard}});var o=s(230),l=s(7437),a=s(6691),n=s.n(a),i=s(1806);let fetchPost=async(e,t,s)=>{let o=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:"".concat(t)}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),l=await o.json(),a=[];return l.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&a.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),console.log("rough data : ",l),a};var r=s(2265),c=s(5883),d=s(62);function _templateObject(){let e=(0,o._)(["\n    transition: 0.2s ease;\n    cursor: pointer;\n    &:hover div{\n        filter: brightness(.5);\n    }\n    &:hover p{\n        opacity: 1;\n    }\n"]);return _templateObject=function(){return e},e}function PostBoard(e){let[t,s]=(0,r.useState)(),o=(0,c.Zl)(d.curPostStore),[a,i]=(0,r.useState)(e.data),[m,h]=(0,r.useState)(40),[f,p]=(0,r.useState)(80),[v,A]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!0),[j,w]=(0,c.FV)(d.isPostViewOpenStore),handleClickPost=e=>{o(e),w(!0)};return(0,r.useEffect)(()=>{if(g)x(!1);else{let t=fetchPost(m-40,e.location,f-40);t.then(e=>{let t=[];void 0!==a&&((t=[...a]).splice(m-40,40,...e),i(t),console.log("post updated",e))})}},[j]),(0,r.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(t=>{let[s]=t;if(s.isIntersecting){console.log("진입",m,f);let t=fetchPost(m,e.location,f);t.then(e=>{void 0!==a&&(i([...a,...e]),h(e=>e+40),p(e=>e+40),A(!0),setTimeout(()=>{A(!1)},2e3))})}},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,f]),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"grid grid-cols-3 gap-1",children:void 0!==a&&a.map((e,t)=>(0,l.jsxs)(u,{className:"center",onClick:()=>handleClickPost(e),children:[(0,l.jsx)("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),(0,l.jsx)("div",{children:(0,l.jsx)(n(),{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t))}),(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("div",{className:"w-full h-[100vh]"})})]})}let u=i.ZP.div(_templateObject())},2974:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostView}});var o=s(230),l=s(7437),a=s(6691),n=s.n(a),i=s(4741);function PostSlider(e){var t;let s=null===(t=e.post)||void 0===t?void 0:t.photo,o={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:(0,l.jsx)(function(e){let{className:t,style:s,onClick:o}=e;return(0,l.jsx)("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:o})},{})};return(0,l.jsx)("div",{className:"h-full w-full",children:void 0!==s&&1!==s.length?(0,l.jsx)(i.Z,{...o,children:null==s?void 0:s.map((e,t)=>(0,l.jsx)("div",{className:"w-[40vw] h-[85vh]",children:(0,l.jsx)(n(),{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[85vh]"})},t))}):(0,l.jsx)("div",{className:"w-[40vw] h-[85vh] flex items-center",children:(0,l.jsx)(n(),{src:void 0!==s&&s[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[85vh]"})},0)})}s(9051),s(5291);var r=s(1806),c=s(2265);function PostContent(e){let{post:t,isModify:s,postId:o,idToken:a,setIsModify:n}=e,[i,r]=(0,c.useState)(""),[d,u]=(0,c.useState)(""),m="text-black focus:outline-none rounded-md border-[1px] w-[12vw] p-2";return(0,c.useEffect)(()=>{t&&(r(t.title),u(t.content))},[t]),(0,l.jsx)("div",{children:s?(0,l.jsxs)("div",{children:[(0,l.jsx)("input",{value:i,onChange:e=>r(e.target.value),className:"".concat(m," nnb")}),(0,l.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),className:"".concat(m," nnn text-[0.8rem]")}),(0,l.jsx)("button",{onClick:()=>{fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(o,"?updateMask.fieldPaths=title"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a)},body:JSON.stringify({fields:{title:{stringValue:i}}})}).then(()=>{console.log("title 수정 완료")}).catch(e=>console.log(e)),fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(o,"?updateMask.fieldPaths=content"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a)},body:JSON.stringify({fields:{content:{stringValue:d}}})}).then(()=>{console.log("content 수정 완료"),n(!1)}).catch(e=>console.log(e))},className:"w-[12vw] bg-[#003545] rounded-md text-sm py-1",children:"수정"})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"nnb",children:i}),(0,l.jsx)("pre",{className:"text-[0.8rem] nnn",children:d})]})})}var d=s(7216),u=s(9904),m=s(6986),h=s(2062),f=s(9903);async function deletePost(e){let t=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(e),{method:"DELETE"});t.json().then(()=>{console.log("게시물 삭제 완료")}).catch(e=>console.log("게시물 삭제 에러",e))}async function removeLike(e,t,s,o){let l;null!==localStorage&&localStorage.getItem("ddym-email");let a=[];0!==s.length&&(a=[...s]);let n=a.findIndex(e=>e.stringValue===l);a.splice(n,1);let i=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:a}}}})});return o(a),(await i).json()}async function uploadLike(e,t,s,o){let l=localStorage.getItem("ddym-email"),a=[];0!==s.length&&(a=[...s]),a.push({stringValue:l});let n=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:a}}}})});return o(a),(await n).json()}s(3085);var p=s(994),v=s(5075);async function UploadComment(e,t,s,o){(0,p.ZF)(v.q);let l=localStorage.getItem("ddym-email"),a=[];0!==o.length&&(a=[...o]),a.push({mapValue:{fields:{comment:{stringValue:s},user:{stringValue:l}}}}),console.log(a),fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=comments"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{comments:{arrayValue:{values:a}}}})})}var A=s(5883),g=s(9783),x=s(62),j=s(4033);function _templateObject(){let e=(0,o._)(["\n    transition: 0.15s ease;\n    height: 2vh;\n    transform-origin: center;\n    &:active {\n        scale:1.3\n    }\n"]);return _templateObject=function(){return e},e}function PostView(){let e=(0,j.useRouter)(),t=(0,A.sJ)(x.idTokenStore),s=(0,A.sJ)(x.userDataStore),[o,a]=(0,A.FV)(x.curPostStore),[i,r]=(0,c.useState)([0]),[p,v]=(0,c.useState)(""),[y,N]=(0,c.useState)([]),[S,k]=(0,c.useState)(!1),[b,P]=(0,c.useState)(""),[V,C]=(0,c.useState)("invisible"),[O,E]=(0,c.useState)(""),[I,z]=(0,A.FV)(x.isPostViewOpenStore),[B,D]=(0,c.useState)(!1),L={color:"black",width:20,cursor:"pointer"};(0,c.useEffect)(()=>{if(o){if(void 0!==o.likes?r([...o.likes]):r([]),void 0!==o.user&&(0,g.A)(o.user).then(e=>{void 0!==e&&""!==e.displayName?E(e.displayName):E(o.user)}),void 0!==o.name){let e=o.name.split("/");P(e[6])}o.comments.map(e=>{let t=e.mapValue.fields.user.stringValue;(0,g.A)(t).then(s=>{let o,l;void 0!==s&&(l=""!==s.photoURL?s.photoURL:f.Z,o={user:s.displayName,photoURL:l,email:t,comment:e.mapValue.fields.comment.stringValue}),N(e=>[...e,o])})})}},[o]),(0,c.useEffect)(()=>{let e=localStorage.getItem("ddym-email");void 0!==i.find(t=>t.stringValue===e)?k(!0):k(!1)},[i]),(0,c.useEffect)(()=>{I?C("flex"):C("invisible")},[I]);let handleClickProfile=t=>{e.push("/profile/".concat(t))};return(0,l.jsx)("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&(B?window.confirm("게시물 수정을 취소하시겠습니까?")&&resetData():resetData());function resetData(){z(!1),N([]),r([0]),D(!1)}},className:"w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ".concat(V),children:(0,l.jsxs)("div",{className:"flex w-[60vw] h-[85vh] bg-white shadow-2xl",children:[(0,l.jsx)("div",{className:"flex w-2/3 h-full ",children:(0,l.jsx)(PostSlider,{post:o})}),(0,l.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,l.jsxs)("div",{className:"p-6 flex-1",children:[(0,l.jsxs)("div",{className:"",children:[(0,l.jsxs)("div",{className:"flex nnn",children:[(null==s?void 0:s.photoURL)===void 0?(0,l.jsx)(n(),{src:f.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):(0,l.jsx)(l.Fragment,{}),(null==s?void 0:s.displayName)===void 0?(0,l.jsx)("p",{children:O}):(0,l.jsx)(l.Fragment,{children:s.displayName})]}),(0,l.jsx)("div",{className:"mt-1 ml-8",children:(0,l.jsx)(PostContent,{post:o,setIsModify:D,isModify:B,postId:b,idToken:t})})]}),(0,l.jsx)("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==y&&y.map((e,t)=>(0,l.jsxs)("div",{className:"mt-6 flex",children:[(0,l.jsxs)("div",{className:"flex cursor-pointer",onClick:()=>handleClickProfile(e.email),children:[(0,l.jsx)(n(),{src:e.photoURL,width:30,height:30,alt:"profile",className:"rounded-full object-cover aspect-square"}),(0,l.jsx)("p",{className:"nnb text-[0.8rem] ml-1",children:e.user})]}),(0,l.jsx)("p",{className:"nnn text-[0.7rem] ml-3",children:e.comment})]},t))})]}),(0,l.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,l.jsxs)("div",{className:"flex flex-1 mt-1",children:[S?(0,l.jsx)(w,{onClick:()=>{o&&removeLike(o,t,i,r)},children:(0,l.jsx)(d.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):(0,l.jsx)(w,{onClick:()=>{o&&""!==i?uploadLike(o,t,i,r):k(!0)},children:(0,l.jsx)(m.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,l.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[i.length," 명이 좋아합니다"]}),(0,l.jsx)("div",{className:"flex-1"}),(0,l.jsxs)("div",{className:"mt-[-2px]",children:[(0,l.jsx)(h.Z,{sx:L,onClick:()=>{window.confirm("게시물을 삭제하시겠습니까?")&&(deletePost(b),z(!1),a(null))}}),(0,l.jsx)(u.Z,{sx:L,onClick:()=>{D(!0)}})]})]}),(0,l.jsxs)("div",{className:"flex flex-row",children:[(0,l.jsx)("input",{value:p,onChange:e=>v(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),(0,l.jsx)("button",{onClick:()=>{let e=localStorage.getItem("ddym-email");o&&""!==p&&(UploadComment(o,t,p,o.comments),e&&(0,g.A)(e).then(t=>{if(void 0!==t){let s={email:e,photoURL:null==t?void 0:t.photoURL,comment:p,user:null==t?void 0:t.displayName};N(e=>[...e,s])}}),v(""))},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let w=r.ZP.div(_templateObject())},9783:function(e,t,s){"use strict";s.d(t,{A:function(){return getProfile}});let getProfile=async e=>{let t;console.log("looking for",e,"'s data");let s=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/".concat(e),{method:"GET"}),o=await s.json();return void 0!==o.fields&&(t={displayName:o.fields.displayName.stringValue,photoURL:o.fields.photoURL.stringValue,follower:o.fields.follewer.arrayValue.values,follow:o.fields.follow.arrayValue.values}),t}},62:function(e,t,s){"use strict";s.r(t),s.d(t,{curComments:function(){return i},curPostStore:function(){return u},default:function(){return RecoilContextProvider},idTokenStore:function(){return r},isLoginStore:function(){return n},isPostViewOpenStore:function(){return m},profileStore:function(){return a},selectedPointStore:function(){return d},userDataStore:function(){return c}});var o=s(7437);s(2265);var l=s(5883);let a=(0,l.cn)({key:"profile",default:{}}),n=(0,l.cn)({key:"isLogin",default:!1}),i=(0,l.cn)({key:"curComments",default:""}),r=(0,l.cn)({key:"idTokenStore",default:""}),c=(0,l.cn)({key:"userDataStore",default:null}),d=(0,l.cn)({key:"selectedPointStore",default:""}),u=(0,l.cn)({key:"curPostStore",default:null}),m=(0,l.cn)({key:"isPostViewOpen",default:!1});function RecoilContextProvider(e){let{children:t}=e;return(0,o.jsx)(l.Wh,{children:t})}},5075:function(e,t,s){"use strict";s.d(t,{q:function(){return o}});let o={apiKey:"AIzaSyCA6Q_TA6dyl7wf2BtR_V_oEVIW2_Q94y0",authDomain:"daedongyourmap-ad63d.firebaseapp.com",projectId:"daedongyourmap-ad63d",storageBucket:"daedongyourmap-ad63d.appspot.com",messagingSenderId:"68098855208",appId:"1:68098855208:web:aa0e9a5602074a3b6c401d",measurementId:"G-7X00QEEQ08"}},9903:function(e,t){"use strict";t.Z={src:"/_next/static/media/defaultProfilePic.513224af.jpeg",height:360,width:360,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAeEAABAwQDAAAAAAAAAAAAAAAAEhMVAgMUIjNB8f/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCmSNM+3k3G+NtOqvewAB//2Q==",blurWidth:8,blurHeight:8}}},function(e){e.O(0,[691,380,964,928,795,161,472,732,11,971,864,744],function(){return e(e.s=7559)}),_N_E=e.O()}]);