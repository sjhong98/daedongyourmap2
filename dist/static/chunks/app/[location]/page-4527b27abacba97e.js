(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[635],{7559:function(e,t,s){Promise.resolve().then(s.bind(s,3230)),Promise.resolve().then(s.bind(s,2974))},3230:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostBoard}});var a=s(230),o=s(7437),n=s(6691),l=s.n(n),i=s(1806);let fetchPost=async(e,t,s)=>{let a=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents:runQuery",{method:"POST",cache:"no-cache",body:JSON.stringify({structuredQuery:{from:[{collectionId:"posts"}],where:{fieldFilter:{field:{fieldPath:"point"},op:"EQUAL",value:{stringValue:"".concat(t)}}},orderBy:[{field:{fieldPath:"createTime"},direction:"DESCENDING"}]}})}),o=await a.json(),n=[];return o.map(e=>{let t,s=e.document;t=void 0===s.fields.comments.arrayValue.values?[]:s.fields.comments.arrayValue.values,void 0!==s&&n.push({createTime:s.createTime,title:s.fields.title.stringValue,content:s.fields.content.stringValue,point:s.fields.point.stringValue,photo:s.fields.photo.arrayValue.values,user:s.fields.user.stringValue,comments:t,name:s.name,likes:s.fields.likes.arrayValue.values})}),n};var r=s(2265),c=s(5883),d=s(62);function _templateObject(){let e=(0,a._)(["\n    transition: 0.2s ease;\n    cursor: pointer;\n    &:hover div{\n        filter: brightness(.5);\n    }\n    &:hover p{\n        opacity: 1;\n    }\n"]);return _templateObject=function(){return e},e}function PostBoard(e){let[t,s]=(0,r.useState)(),a=(0,c.Zl)(d.curPostStore),[n,i]=(0,r.useState)(e.data),[f,m]=(0,r.useState)(40),[h,p]=(0,r.useState)(80),[v,A]=(0,r.useState)(!1),[g,x]=(0,r.useState)(!0),[j,w]=(0,c.FV)(d.isPostViewOpenStore),handleClickPost=e=>{a(e),w(!0)};return(0,r.useEffect)(()=>{if(g)x(!1);else{let t=fetchPost(f-40,e.location,h-40);t.then(e=>{let t=[];void 0!==n&&((t=[...n]).splice(f-40,40,...e),i(t),console.log("post updated",e))})}},[j]),(0,r.useEffect)(()=>{let s;return t&&(s=new IntersectionObserver(t=>{let[s]=t;if(s.isIntersecting){console.log("진입",f,h);let t=fetchPost(f,e.location,h);t.then(e=>{void 0!==n&&(i([...n,...e]),m(e=>e+40),p(e=>e+40),A(!0),setTimeout(()=>{A(!1)},2e3))})}},{root:null,threshold:.8})).observe(t),()=>{s&&s.disconnect()}},[t,h]),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"grid grid-cols-3 gap-1",children:void 0!==n&&n.map((e,t)=>(0,o.jsxs)(u,{className:"center",onClick:()=>handleClickPost(e),children:[(0,o.jsx)("p",{className:"absolute text-white nnn opacity-0 z-[100]",children:e.title}),(0,o.jsx)("div",{children:(0,o.jsx)(l(),{src:void 0!==e.photo&&e.photo[0].stringValue,alt:e.title,width:400,height:400,className:"aspect-square object-cover object-center w-[20vw]"})})]},t))}),(0,o.jsx)("div",{className:"flex flex-col",children:(0,o.jsx)("div",{className:"w-full h-[100vh]"})})]})}let u=i.ZP.div(_templateObject())},2974:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PostView}});var a=s(230),o=s(7437),n=s(6691),l=s.n(n),i=s(4741);function PostSlider(e){var t;let s=null===(t=e.post)||void 0===t?void 0:t.photo,a={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,nextArrow:(0,o.jsx)(function(e){let{className:t,style:s,onClick:a}=e;return(0,o.jsx)("div",{className:t,style:{...s,display:"block",filter:"invert(50%)"},onClick:a})},{})};return(0,o.jsx)("div",{className:"h-full w-full",children:void 0!==s&&1!==s.length?(0,o.jsx)(i.Z,{...a,children:null==s?void 0:s.map((e,t)=>(0,o.jsx)("div",{className:"w-[40vw] h-[85vh]",children:(0,o.jsx)(l(),{src:e.stringValue,alt:"...",width:600,height:600,className:"object-cover max-h-[85vh]"})},t))}):(0,o.jsx)("div",{className:"w-[40vw] h-[85vh] flex items-center",children:(0,o.jsx)(l(),{src:void 0!==s&&s[0].stringValue,alt:"...",width:600,height:800,className:"object-cover max-h-[85vh]"})},0)})}s(9051),s(5291);var r=s(1806),c=s(2265);function PostContent(e){let{post:t,isModify:s,postId:a,idToken:n,setIsModify:l}=e,[i,r]=(0,c.useState)(""),[d,u]=(0,c.useState)(""),f="text-black focus:outline-none rounded-md border-[1px] w-[12vw] p-2";return(0,c.useEffect)(()=>{t&&(r(t.title),u(t.content))},[t]),(0,o.jsx)("div",{children:s?(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{value:i,onChange:e=>r(e.target.value),className:"".concat(f," nnb")}),(0,o.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),className:"".concat(f," nnn text-[0.8rem]")}),(0,o.jsx)("button",{onClick:()=>{fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(a,"?updateMask.fieldPaths=title"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(n)},body:JSON.stringify({fields:{title:{stringValue:i}}})}).then(()=>{console.log("title 수정 완료")}).catch(e=>console.log(e)),fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(a,"?updateMask.fieldPaths=content"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(n)},body:JSON.stringify({fields:{content:{stringValue:d}}})}).then(()=>{console.log("content 수정 완료"),l(!1)}).catch(e=>console.log(e))},className:"w-[12vw] bg-[#003545] rounded-md text-sm py-1",children:"수정"})]}):(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"nnb",children:i}),(0,o.jsx)("pre",{className:"text-[0.8rem] nnn",children:d})]})})}var d=s(7216),u=s(9904),f=s(6986),m=s(2062),h=s(9903),p=s(3085);async function deletePost(e){let t=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/posts/".concat(e),{method:"DELETE"});t.json().then(()=>{console.log("게시물 삭제 완료")}).catch(e=>console.log("게시물 삭제 에러",e))}async function removeLike(e,t,s,a){let o;null!==localStorage&&localStorage.getItem("ddym-email");let n=[];0!==s.length&&(n=[...s]);let l=n.findIndex(e=>e.stringValue===o);n.splice(l,1);let i=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:n}}}})});return a(n),(await i).json()}async function uploadLike(e,t,s,a){let o=localStorage.getItem("ddym-email"),n=[];0!==s.length&&(n=[...s]),n.push({stringValue:o});let l=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=likes"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{likes:{arrayValue:{values:n}}}})});return a(n),(await l).json()}var v=s(5075),A=s(994);async function UploadComment(e,t,s,a,o){(0,A.ZF)(v.q);let n=(0,p.v0)(),l=[];0!==a.length&&(l=[...a]),l.push({mapValue:{fields:{user:{stringValue:n.currentUser&&n.currentUser.email},comment:{stringValue:s}}}});let i=fetch("https://firestore.googleapis.com/v1/".concat(e.name,"?updateMask.fieldPaths=comments"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify({fields:{comments:{arrayValue:{values:l}}}})});return o(l),(await i).json()}var g=s(5883),x=s(9783),j=s(62);function _templateObject(){let e=(0,a._)(["\n    transition: 0.15s ease;\n    height: 2vh;\n    transform-origin: center;\n    &:active {\n        scale:1.3\n    }\n"]);return _templateObject=function(){return e},e}function PostView(){let e=(0,g.sJ)(j.idTokenStore),t=(0,g.sJ)(j.userDataStore),[s,a]=(0,g.FV)(j.curPostStore),[n,i]=(0,c.useState)([0]),[r,p]=(0,c.useState)([]),[v,A]=(0,c.useState)(""),[y,N]=(0,c.useState)(!1),[S,k]=(0,c.useState)(""),[b,V]=(0,c.useState)("invisible"),[P,C]=(0,c.useState)(""),[O,E]=(0,g.FV)(j.isPostViewOpenStore),[z,I]=(0,c.useState)(!1),B={color:"black",width:20,cursor:"pointer"};return(0,c.useEffect)(()=>{if(s){if(void 0!==s.likes?i([...s.likes]):i([]),void 0!==s.user){(0,x.A)(s.user).then(e=>{void 0!==e&&""!==e.displayName?C(e.displayName):C(s.user)});let e=[...r];s.comments.map((t,s)=>{""!==t.mapValue.fields.user.stringValue&&(0,x.A)(t.mapValue.fields.user.stringValue).then(a=>{console.log("test : ",t.mapValue.fields.user.stringValue,a),void 0!==a&&(e[s].user=a.displayName)})}),p(e)}if(void 0!==s.name){let e=s.name.split("/");k(e[6])}}},[s]),(0,c.useEffect)(()=>{let e=localStorage.getItem("ddym-email");void 0!==n.find(t=>t.stringValue===e)?N(!0):N(!1)},[n]),(0,c.useEffect)(()=>{O?V("flex"):V("invisible")},[O]),(0,o.jsx)("div",{id:"outside-view",onClick:e=>{"outside-view"===e.target.id&&(z?window.confirm("게시물 수정을 취소하시겠습니까?")&&resetData():resetData());function resetData(){E(!1),p([0]),i([0]),I(!1)}},className:"w-screen h-screen center fixed backdrop-blur-lg mt-[-20vh] z-[1000] ".concat(b),children:(0,o.jsxs)("div",{className:"flex w-[60vw] h-[85vh] bg-white shadow-2xl",children:[(0,o.jsx)("div",{className:"flex w-2/3 h-full ",children:(0,o.jsx)(PostSlider,{post:s})}),(0,o.jsxs)("div",{className:"w-1/3 h-full flex flex-col",children:[(0,o.jsxs)("div",{className:"p-6 flex-1",children:[(0,o.jsxs)("div",{className:"",children:[(0,o.jsxs)("div",{className:"flex nnn",children:[(null==t?void 0:t.photoURL)===void 0?(0,o.jsx)(l(),{src:h.Z,alt:"profile",className:"rounded-full w-[1.5vw] mr-3 mt-1"}):(0,o.jsx)(o.Fragment,{}),(null==t?void 0:t.displayName)===void 0?(0,o.jsx)("p",{children:P}):(0,o.jsx)(o.Fragment,{children:t.displayName})]}),(0,o.jsx)("div",{className:"mt-1 ml-8",children:(0,o.jsx)(PostContent,{post:s,setIsModify:I,isModify:z,postId:S,idToken:e})})]}),(0,o.jsx)("div",{className:"w-full h-full pt-10 overflow-auto",children:void 0!==r&&r.map((e,t)=>(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"nnn text-[0.8rem] mt-6",children:void 0!==e.mapValue&&e.mapValue.fields.user.stringValue}),(0,o.jsx)("p",{className:"nnn text-[0.7rem]",children:void 0!==e.mapValue&&e.mapValue.fields.comment.stringValue})]},t))})]}),(0,o.jsxs)("div",{className:"flex flex-col h-[10vh] border-t-[1px]",children:[(0,o.jsxs)("div",{className:"flex flex-1 mt-1",children:[y?(0,o.jsx)(w,{onClick:()=>{s&&removeLike(s,e,n,i)},children:(0,o.jsx)(d.Z,{sx:{color:"red"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}):(0,o.jsx)(w,{onClick:()=>{s&&""!==n?uploadLike(s,e,n,i):N(!0)},children:(0,o.jsx)(f.Z,{sx:{color:"#000"},className:"w-4 mt-[-1vh] ml-3 cursor-pointer"})}),(0,o.jsxs)("p",{className:"nnn text-[0.8rem] ml-1",children:[n.length," 명이 좋아합니다"]}),(0,o.jsx)("div",{className:"flex-1"}),(0,o.jsxs)("div",{className:"mt-[-2px]",children:[(0,o.jsx)(m.Z,{sx:B,onClick:()=>{window.confirm("게시물을 삭제하시겠습니까?")&&(deletePost(S),E(!1),a(null))}}),(0,o.jsx)(u.Z,{sx:B,onClick:()=>{I(!0)}})]})]}),(0,o.jsxs)("div",{className:"flex flex-row",children:[(0,o.jsx)("input",{value:v,onChange:e=>A(e.target.value),placeholder:"댓글을 입력하세요",className:"focus:outline-none text-[0.8rem] text-black nnn p-1 pl-4 w-5/6"}),(0,o.jsx)("button",{onClick:()=>{s&&""!==v&&UploadComment(s,e,v,r,p).then(e=>{console.log("댓글 추가 성공",e),A("")}).catch(e=>{console.log("댓글 추가 실패",e)})},className:"w-1/6 rounded-xl text-[0.7rem] nnn text-black",children:"입력"})]})]})]})]})})}let w=r.ZP.div(_templateObject())},9783:function(e,t,s){"use strict";s.d(t,{A:function(){return getProfile}});let getProfile=async e=>{let t;console.log("looking for",e,"...");let s=await fetch("https://firestore.googleapis.com/v1/projects/daedongyourmap-ad63d/databases/(default)/documents/users/".concat(e),{method:"GET"}),a=await s.json();return void 0!==a.field&&(t={displayName:a.fields.displayName.stringValue,photoURL:a.fields.photoURL.stringValue,follower:a.fields.follewer.arrayValue.values,follow:a.fields.follow.arrayValue.values}),t}},62:function(e,t,s){"use strict";s.r(t),s.d(t,{curComments:function(){return i},curPostStore:function(){return u},default:function(){return RecoilContextProvider},idTokenStore:function(){return r},isLoginStore:function(){return l},isPostViewOpenStore:function(){return f},profileStore:function(){return n},selectedPointStore:function(){return d},userDataStore:function(){return c}});var a=s(7437);s(2265);var o=s(5883);let n=(0,o.cn)({key:"profile",default:{}}),l=(0,o.cn)({key:"isLogin",default:!1}),i=(0,o.cn)({key:"curComments",default:""}),r=(0,o.cn)({key:"idTokenStore",default:""}),c=(0,o.cn)({key:"userDataStore",default:null}),d=(0,o.cn)({key:"selectedPointStore",default:""}),u=(0,o.cn)({key:"curPostStore",default:null}),f=(0,o.cn)({key:"isPostViewOpen",default:!1});function RecoilContextProvider(e){let{children:t}=e;return(0,a.jsx)(o.Wh,{children:t})}},5075:function(e,t,s){"use strict";s.d(t,{q:function(){return a}});let a={apiKey:"AIzaSyCA6Q_TA6dyl7wf2BtR_V_oEVIW2_Q94y0",authDomain:"daedongyourmap-ad63d.firebaseapp.com",projectId:"daedongyourmap-ad63d",storageBucket:"daedongyourmap-ad63d.appspot.com",messagingSenderId:"68098855208",appId:"1:68098855208:web:aa0e9a5602074a3b6c401d",measurementId:"G-7X00QEEQ08"}},9903:function(e,t){"use strict";t.Z={src:"/_next/static/media/defaultProfilePic.513224af.jpeg",height:360,width:360,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wAARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAf/xAAeEAABAwQDAAAAAAAAAAAAAAAAEhMVAgMUIjNB8f/EABQBAQAAAAAAAAAAAAAAAAAAAAD/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCmSNM+3k3G+NtOqvewAB//2Q==",blurWidth:8,blurHeight:8}}},function(e){e.O(0,[691,380,964,928,13,161,472,732,11,971,864,744],function(){return e(e.s=7559)}),_N_E=e.O()}]);